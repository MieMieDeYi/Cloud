import{bG as f,bH as a,bI as c,bJ as u,bK as l,bB as d,bL as h,i as p}from"./index.6d4055d0.js";import{d as m}from"./Explore.5bdeed77.js";import k from"./YIcon.481673e0.js";const r="SHARE_TOKEN",i=f("share",{state:()=>({token:window.sessionStorage.getItem(r)?window.sessionStorage.getItem(r):null,unsafeToken:""}),actions:{setToken(e,t){this.token=t,window.sessionStorage.setItem(r,t)},clearToken(){this.token=null,window.sessionStorage.removeItem(r)},async getUnsafeToken(){return this.unsafeToken||(console.log("\u83B7\u53D6 unsafe token \u4E2D (share)"),await s.post(a("/unsafeToken"),null).then(e=>{console.log(e.token),this.unsafeToken=e.token})),this.unsafeToken}}}),s=c.create({headers:{"Content-Type":"application/json;charset=utf-8"}});s.defaults.withCredentials=!1;s.interceptors.request.use(function(e){return e.headers||(e.headers={}),e.headers.Authorization="Bearer "+i().token,e});s.interceptors.response.use(function(e){return e.data.code===200?e.data:(u(e),Promise.reject(e))},function(e){return e.response.status==401&&(i().clearToken(),l.go(0)),u(e.response),Promise.reject(e.response)});const g=e=>d.post(a("/share/create"),e).then(t=>{if(t.code==200)return t.data}),w=(e,t,n={})=>(t==null&&(n.show=!1),s.post(a("/share/pass"),{id:e,password:t},n).then(o=>{if(o.code==200&&o.token)i().setToken(e,o.token);else return Promise.reject(o);return o})),T=(e,t)=>s.post(a("/share/list"),{id:e,path:t}).then(n=>{if(n.code==200)return n.data}),E=(e,t)=>s.post(a("/share/pre_download"),{resourceId:e,path:t}).then(n=>{if(n.code==200){const o=`${a("/resource/download",!1)}?entry=${n.data}`;m(o)}}),I=e=>i().getUnsafeToken().then(t=>`${h}/${e}?token=${t}`),$={createShare:g,pass:w,getShareList:T,download:E,preview:I},x={image:{suffix:["jpg","png","jpeg"],icon:"file-image"},video:{suffix:["mp4","avi"],icon:"file-video"},audio:{suffix:["mp3","ogg"],icon:"file-audio"},text:{suffix:["txt","js","ts","java","md"],icon:"file-code"},package:{suffix:["zip","rar","7z","tar"],icon:"file-zipper"}},j=function(e="FILE"){let t="file";if(e=e.toLowerCase(),e==="dir")return"fa-folder";for(let n of Object.values(x))n.suffix.includes(e)&&(t=n.icon);return"fa-"+t},v=function(e="file",t=13){return p(k,{name:j(e),size:t,color:e==="dir"?"#E66E05":"#333",class:"fileIcon"},null)};export{$ as A,j as a,v as f,i as s};
